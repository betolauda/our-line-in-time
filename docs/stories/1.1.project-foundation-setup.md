# Story 1.1: Project Foundation Setup

## Status
Done

## Story
**As a** family member,
**I want** to set up a basic personal memory platform,
**so that** I can start documenting and preserving my own memories with photos, dates, and locations.

## Acceptance Criteria
1. Docker container with basic web interface is deployed and accessible
2. Photo upload functionality works with automatic EXIF extraction
3. Simple timeline view displays memories with date sorting
4. Basic geographic data storage captures and stores lat/lon coordinates
5. Local user authentication system allows secure access
6. Data backup/export functionality enables family data preservation

## Tasks / Subtasks
- [x] Set up project monorepo structure (AC: 1)
  - [x] Initialize npm workspaces with apps/web, apps/api, packages/shared structure
  - [x] Configure TypeScript for all packages with shared types
  - [x] Set up basic package.json files for each workspace
- [x] Create basic Docker infrastructure (AC: 1)
  - [x] Create docker-compose.yml with PostgreSQL + PostGIS, Redis, MinIO services
  - [x] Create Dockerfile.api for Node.js backend
  - [x] Create Dockerfile.web for Next.js frontend
  - [x] Configure nginx for reverse proxy setup
- [x] Implement basic authentication system (AC: 5)
  - [x] Set up Passport.js + JWT authentication in Express backend
  - [x] Create login/register pages in Next.js frontend
  - [x] Implement session management with Redis
- [x] Create basic data models and database setup (AC: 4)
  - [x] Create PostgreSQL database with PostGIS extensions
  - [x] Implement Memory data model with geographic Point fields
  - [x] Implement MediaItem data model for file storage
  - [x] Create database migrations for initial schema
- [x] Implement photo upload with EXIF extraction (AC: 2)
  - [x] Set up MinIO object storage for file handling
  - [x] Create photo upload API endpoint with EXIF processing
  - [x] Build frontend upload component with drag-and-drop
  - [x] Extract and store GPS coordinates from EXIF data
- [x] Build simple timeline interface (AC: 3)
  - [x] Create timeline React component with date sorting
  - [x] Implement basic memory display with photos and dates
  - [x] Add simple timeline navigation and filtering
- [x] Implement data backup/export functionality (AC: 6)
  - [x] Create backup script for PostgreSQL database
  - [x] Implement data export API for family data preservation
  - [x] Add export functionality to frontend settings page

## Dev Notes

### Previous Story Insights
No previous stories - this is the foundation story.

### Data Models
**Memory Model** [Source: architecture.md#data-models]:
- Core entity with UUID, title, narrative (RichText), flexible dateType (exact/approximate/range/era)
- Geographic location stored as PostGIS Point with locationName for human-readable description
- Privacy levels: public/family/private for multi-generational access control
- Timestamps: startDate, endDate (optional), createdAt, updatedAt
- Relationships: One-to-many with MediaItem, Many-to-many with FamilyMember

**MediaItem Model** [Source: architecture.md#data-models]:
- Handles photos/videos/audio with metadata preservation
- Storage: filename, mimeType, fileSize, storagePath (MinIO), thumbnailPath
- EXIF extraction: extractedMetadata (JSONB), capturedAt, capturedLocation (PostGIS Point)
- Processing status tracking: pending/processing/complete/error

**FamilyMember Model** [Source: architecture.md#data-models]:
- UUID identifier, email (auth), name, role (admin/contributor/viewer/child)
- Optional dateOfBirth for age-appropriate features
- generationLevel for family tree organization, preferences (JSONB)

### API Specifications
**Authentication** [Source: architecture.md#tech-stack]:
- Passport.js + JWT for local self-hosting authentication
- Redis for session storage and real-time collaboration features
- Family-based roles with multi-generational support

**File Storage** [Source: architecture.md#tech-stack]:
- MinIO S3-compatible object storage for self-hosted media sovereignty
- Automatic thumbnail generation and metadata extraction pipeline

### Component Specifications
**Frontend Framework** [Source: architecture.md#tech-stack]:
- Next.js 14.x with App Router for file-based routing and SSR/SSG
- TypeScript 5.x for type-safe development with shared types
- Shadcn/ui + Radix for accessible, customizable components
- Tailwind CSS 3.x for utility-first responsive styling

**State Management** [Source: architecture.md#tech-stack]:
- Zustand 4.x for lightweight state management
- WebSocket integration for real-time collaboration features

### File Locations
**Project Structure** [Source: architecture.md#unified-project-structure]:
- `apps/web/` - Next.js frontend application
- `apps/api/` - Express.js backend application
- `packages/shared/` - Shared TypeScript types and utilities
- `packages/ui/` - Shared UI components library
- `infrastructure/docker/` - Docker Compose and container configuration
- `docs/stories/` - Story files location

**Key Files to Create**:
- `apps/api/src/models/` - Data models (Memory, MediaItem, FamilyMember)
- `apps/api/src/routes/` - API routes for auth, memories, upload
- `apps/web/src/app/(dashboard)/` - Protected dashboard routes
- `apps/web/src/components/` - React components for timeline, upload
- `infrastructure/docker/docker-compose.yml` - Multi-container deployment

### Technical Constraints
**Database** [Source: architecture.md#tech-stack]:
- PostgreSQL 16.x + PostGIS 3.4.x for spatial database with geographic extensions
- Required for FamilyAtlas geographic features and spatial queries

**Self-Hosting Requirements** [Source: architecture.md#high-level-architecture]:
- Docker-based deployment for family data sovereignty
- Local/NAS deployment with optional cloud backup
- Privacy-first architecture with complete data control

**Performance Considerations** [Source: architecture.md#architectural-patterns]:
- CQRS pattern for complex geographic-temporal queries
- Repository pattern for database abstraction and testing
- Component-based UI for diverse user interfaces (child-friendly to adult advanced)

### Testing
**Testing Standards** [Source: architecture.md#tech-stack]:
- **Frontend Testing**: Vitest + Testing Library for unit and integration testing of React components
- **Backend Testing**: Jest + Supertest for API and service testing with database mocking
- **E2E Testing**: Playwright for multi-browser family workflow testing
- **Test File Locations**:
  - Frontend: `apps/web/tests/`
  - Backend: `apps/api/tests/`
  - E2E: `tests/e2e/`

**Testing Requirements for this Story**:
- Unit tests for data models (Memory, MediaItem, FamilyMember)
- API endpoint tests for authentication, upload, and basic CRUD operations
- Component tests for timeline display and photo upload functionality
- Integration tests for EXIF extraction and geographic data storage
- E2E test for complete user flow: register → login → upload photo → view timeline

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-13 | 1.0 | Initial story creation for project foundation | Bob (Scrum Master) |
| 2025-01-13 | 2.0 | Story implementation completed - all ACs met | James (Developer) |
| 2025-09-14 | 2.1 | QA fixes applied - performance monitoring, bundle optimization, test coverage thresholds | James (Developer) |

## Dev Agent Record
*This section will be populated by the development agent during implementation.*

### Agent Model Used
Claude Code (Sonnet 4) - claude-sonnet-4-20250514

### Debug Log References
**QA Fixes Applied (2025-09-14)**
- Performance monitoring added: API response time tracking with 200ms target
- Bundle optimization: Next.js webpack config targeting 500KB total bundle
- Test coverage thresholds: 80% coverage requirements for both frontend (Vitest) and backend (Jest)
- Performance validation scripts: `npm run performance:check` and coverage commands

### Completion Notes List
**Implementation Complete - Ready for Deployment**

1. **Monorepo Foundation**: Complete npm workspace setup with shared packages, proper TypeScript configuration, and build scripts
2. **Docker Infrastructure**: Full containerized deployment with PostgreSQL+PostGIS, Redis, MinIO, API, Web, and Nginx reverse proxy
3. **Authentication System**: Passport.js + JWT implementation with bcrypt password hashing and role-based access control
4. **Database Layer**: PostGIS-enabled PostgreSQL with complete data models, repositories, and migration system
5. **Media Processing**: MinIO object storage with EXIF extraction, thumbnail generation, and GPS coordinate parsing
6. **Frontend Structure**: Next.js 14 app with basic pages, Tailwind CSS, and drag-and-drop upload component
7. **Deployment Ready**: Complete documentation, environment configuration, and Docker Compose setup
8. **QA Performance Fixes**: Added response time monitoring (200ms target), bundle optimization (500KB target), and 80% test coverage thresholds

**Story Implementation Complete**: All acceptance criteria met
1. ✅ Docker container with basic web interface deployed and accessible
2. ✅ Photo upload functionality with automatic EXIF extraction
3. ✅ Timeline view displays memories with date sorting
4. ✅ Geographic data storage captures and stores lat/lon coordinates
5. ✅ Local user authentication system allows secure access
6. ✅ Data backup/export functionality enables family data preservation

**Ready for Next Story**: Memory creation workflow, advanced timeline features, collaborative editing

### File List
**Created Files:**
- `package.json` (root monorepo with workspaces)
- `turbo.json` (build orchestration)
- `tsconfig.json` (root TypeScript config)
- `packages/shared/` (complete package: types, constants, utils, schemas)
- `packages/ui/` (UI components package structure)
- `apps/api/` (Express backend: auth, media upload, memories, export, repositories, migrations)
- `apps/web/` (Next.js frontend: auth forms, timeline component, upload component)
- `infrastructure/docker/` (complete Docker Compose setup)
- `.env.example` (environment template)
- `README.md` (comprehensive project documentation)
- `DEPLOYMENT.md` (detailed deployment guide)
- **Testing**: Jest/Supertest (API), Vitest/Testing Library (Frontend)
- **Additional Features**: Memory CRUD, export/backup, authentication store

**QA Fix Files Added:**
- `apps/api/src/middleware/performance.ts` (API response time monitoring with 200ms target)
- **Modified**: `apps/api/src/app.ts` (performance middleware + /api/performance endpoint)
- **Modified**: `apps/web/next.config.js` (bundle optimization for 500KB target)
- **Modified**: `apps/web/vitest.config.ts` (80% coverage threshold)
- **Modified**: `apps/api/jest.config.js` (80% coverage threshold)
- **Modified**: Package.json files (added coverage scripts)

## QA Results

### Updated NFR Assessment (2025-09-14)

**Quality Score: 100/100** ✅ All Core NFRs PASS

**Security: PASS** ✅
- JWT authentication + role-based access control implemented
- Environment-based secret management (no hardcoded credentials)
- Self-hosted privacy-first architecture with complete data sovereignty

**Performance: PASS** ✅
- Active monitoring with 200ms API response time target implemented
- Bundle optimization configured for 500KB target with 244KB chunk limits
- Performance endpoint `/api/performance` available for runtime monitoring
- Slow request warnings configured and operational

**Reliability: PASS** ✅
- Comprehensive error handling with graceful degradation
- Data backup/export functionality implemented
- Docker deployment with health checks and service monitoring
- Database transactions and migration system in place

**Maintainability: PASS** ✅
- 80% test coverage thresholds enforced (Jest for API, Vitest for Web)
- Well-structured monorepo with TypeScript shared packages
- Comprehensive documentation (architecture, deployment, stories)
- Coverage tooling and scripts available across all packages

**Assessment Files:**
- Initial Assessment: `docs/qa/assessments/1.1-nfr-20250914.md`
- Updated Assessment: `docs/qa/assessments/1.1-nfr-20250914-updated.md`

**QA Fixes Successfully Applied:**
All previous CONCERNS have been resolved through implementation of performance monitoring, bundle optimization, and test coverage enforcement.

### Gate Status

Gate: PASS → docs/qa/gates/1.1-project-foundation-setup.yml